## 安全生产红线

### 变更红线

- 禁止一切未经变更管理平台申请和审批的变更操作（如遇紧急故障处理，事后必须补填申请并得到变更经理的审批）。***一切在客户生产环境执行测变更，都必须得到客户的同意或预授权，并严格按照变更方案执行，在客户允许的时间和范围内执行***。
	1. 变更管理平台：https://gts.work/workbench/tech/standard/change/proWrite
	2. 变更操作包括但不限于*修订底层数据、修改生产环境服务器基础配置（网络、系统相关参数等）、发布版本和变更功能*等。
- 禁止无变更影响面说明、操作步骤、验证方案、应急预案（含回滚方案）的变更，应急预案必须具备可操作性。
- 禁止一切变更方案外的操作（若变更出现非预期情况需要必须和L2或原厂CRE确认后方可执行，若需调整方案需要走紧急变更流程）。
- 禁止在生产环境，执行与变更或线上问题排查无关的操作。
	- 与变更方案计划内容无关的操作：包括但不限于*随意调整变更时间、变更方案内容、变更步骤顺序、搭车变更和变更后的紧急修复*等；若变更出现非预期情况需要立即暂停并升级到主管，若需调整方案需要走紧急变更流程。
- 禁止在客户的非变更窗口、封网期进行变更（紧急故障处理除外）。
- 禁止临时更换既定变更操作人员；临时更改变更方案原则上应改期实施，重新发起变更审批流程，如无法改期的变更，临时更改变更方案必须经过重新审批后方可实施。

- 禁止部署非版本经理提供的版本。
- 禁止执行未经过测试验证通过的变更方案，禁止驻场在无 DOUBLE CHECK 的情况下进行变更。

### 变更管控

- 禁止将预发环境作为测试环境调试。
- 所有变更第一批次要从最小颗粒度灰度开始（不能引起P3或S3及以上故障为限）。每批次灰度变更完成，要有手段确保验证该批次变更成功后，再进行下一批次变更。每批次的变更要避免并行发布和时间间隔过小（具体值视业务情况而定）。
- 涉及到专有云环境外的客户资源变动，一定要得到客户的同意，需要有同意记录。
- 服务上线（含工具平台），需要经过测试、预发验证，且有监控。
- *有重大影响或不熟悉的变更，需要二线支持或产品研发团队参与变更方案的评审，并提前确认应急时的远程支持人员*。
- 管控类、Meta 数据和核心用户数据等要有备份机制，并建立防止数据过量误删除的熔断机制。

### 故障处理

- 某专有云项目若出现 P1 故障，则启动专有云***全局熔断***机制。专有云熔断期内，*各专有云项目的所有类型变更停止发布7天*。
- 对于同一个专有云平台，3个月内，连续发生2次相同原因导致的故障，对相应的故障责任团队发出黄牌警告；若发生3次，对相应的故障责任团队发出红牌警告和问责。
- 当发生 P1 或 P2 故障时，故障相关团队的总负责人、故障相关团队的直接负责人及安全生产值班长必须在10分钟内上线，参与应急处理。
- 可能导致重大故障的紧急风险信息，需主动上报组织应急处理。
- 专有云客户、驻场、L2 工单支持、其他团队判断有故障，必须在第一时间通过钉钉/电话报障给专有云项目对应的CRE。若钉钉反应滞后，请电话联系确保有效报障。若因为报障不及时导致故障影响面扩大将进行问责。

## 故障管理机制

**故障的定义**

- 非计划性的IT服务中断，或者IT服务性能的下降。

**故障管理的目的**

- 尽快恢复服务到正常状态，并且最小化对业务运营的不利影响，从而尽可能地保证服务质量和可用性的水平。

**故障管理的价值**

- 减少业务中断的时间，从而提高服务的可用性。
- 识别业务的有限度并且动态地调配资源。
- 通过分析故障的组成类别，识别出服务需要改进的地方。

### 故障等级

![[Pasted image 20240911144706.png]]

#### 专有云云服务S等级（指客户实际投产的系统业务影响）

**重点运维客户与敏感客户**：

***S1***：客户核心业务中断；客情或外部影响重大。
*S2*：客户核心业务受影响（超时、访问速度慢、重试）；非核心业务中断；产生客情和外部影响。
S3：客户非核心业务受到影响（超时、访问速度慢、重试）；但业务未中断。
S4：不影响客户业务运行（控制台功能异常，配置未生效等）。

**一般客户**：

***S1***：客户对外业务服务全部中断；客情或外部影响重大。
*S2*：客户系统业务功能部分不可用；产生客情和外部影响。
S3：客户生产环境受到影响（超时、访问速度慢、重试等）；但还可用。
S4：不影响客户业务运行（控制台功能异常等）。

#### 客情风险等级

按正在发生与潜在的客情风险程度，分级别为：无客情、一般客情或有客情风险、客情非常严重。有客情或客情风险的，需要详细描述客情具体情况。

### 风险预警定义

风险预警（简称风险）对于云产品平台侧技术异常未达到故障 P 等级、或无法确认异常是否与云平台侧相关，但异常影响到客户业务、出现客情或有潜在客情风险的情况下，需要使用风险预警上报该异常。风险为 X 级别故障记录（不再分 X1X2X3X4 级别），上报同时要根据客户业务受影响的级别提供该风险对应的业务影响 S 等级，并提供相关的客情情况。

### 故障处理要求

- 某专有云项目若出现 ***P1*** 故障，则启动专有云***全局熔断***机制。专有云熔断期内，各专有云项目的所有类型变更停止发布7天。
- 对于同一个专有云平台，3个月内连续发生2次相同原因导致的故障，对相应的故障责任团队发出黄牌警告；若发生3次，对相应的故障责任团队发出红牌警告和问责。
- 当发生 P1 或 P2 故障时，故障相关团队的总负责人、故障相关团队的直接负责人及安全生产值班长必须在10分钟内上线，参与应急处理。
- 可能导致重大故障的紧急风险信息，需主动上报G0C组织应急处理，
- 专有云客户、驻场、L2 工单支持、其他团队判断有故障，必须在第一时间通过钉钉/电话报障给专有云项目对应的 CRE。若钉钉反应滞后，请电话联系确保有效报障。若因为报障不及时导致故障影响面扩大，将进行问责。

## 变更管理规范

### 概述

#### 1.1. 目的

建立一套标准的规范与流程，高效管控所有生产环境的变更活动，保证有意义的变更以最小的代价得到实施，从而保证相关业务价值的最大化，并提高客户满意度。

它的主要目标包括:

- 规范和标准化变更活动，将变更风险控制在尽可能小的范围内。
- 通过有计划、受控的变更操作来降低故障、业务连续性异常和重复劳动发生。规范变更。
- 准备及方案内容，提高变更成功率与可靠性。
- 根据业务需求对变更做出适时、适当地应对。
- 保证所有的变更可追溯，并对齐相关配置项（基线）。
- 保证所有变更操作可监控、可追溯、可回滚，遇到问题后能按既定应急预案解决问题。

#### 1.2. 适用范围

本规范适用于所有阿里云专有云业务相关团队，对用户专有云环境的发布过程、配置修改等，包括手工操作与工具执行所触发的所有变更行为，包括但不限于:

- 专有云项目-阿里云运维/交付：强制要求
- 专有云项目-第三方运维/交付：指导规范
- 专有云项目-客户自维/交付：指导规范

### 变更类型

#### 2.1. 变更职责约束

由CRE运维项目，产研需通过CRE对客提供服务，CRE默认不允许产研直接对客户提供服务，若存在非标部署或产品自运维情况，需邮件确认留档；
若产研未知会到CRE，自行直接对接客户提供服务，因此产生的问题，CRE不承担任何责任。

#### 2.2. 变更场景

##### 1）交付类变更

交付期间对已投入生产业务或客户已投产环境中，所有涉及环境调整的操作均属变更，包括且不仅限以下操作：

- region：下单元region与主region网络并网
- 平台资源调整：产品扩容、IP段扩容
- 云平台本身管控系统的调整：包括管控系统的版本升级，配置参数调整等
- 物理资源的调整：网络调整、宿主机开关机、配置参数调整等
- 所有非只读黑屏的终端指令操作行为
- 生产环境部署的产品功能性测试行为

##### 2）运维类变更

在客户已投产环境中，所有涉及客户环境调整的操作均属变更，包括且不仅限以下操作：

- 平台资源调整：缩容、IP段扩容等
- 云平台本身管控系统的调整：包括管控系统的版本升级，配置参数调整等
- 物理资源的调整，网络调整、宿主机开关机、配置参数调整等
- 所有非只读的黑屏终端指令操作行为（以结果为准，如 PU命令 的查询动作不在管理范围）
- 所有只读类型高位命令操作行为（以结果为准，如 du、select 等查询数据量巨大的场景等）

#### 2.3. 变更分类

##### 1）日常变更定义

一般变更：中低风险、常态化、驻场可独立执行的日常类变更为一般变更。
**高危变更**：涉及网络、数据库、0S修改，批量执行，大量使用root权限，对业务有明确影响的变更。
**紧急变更**：紧急变更是指非变更窗口、封网期间、未提前24小时计划的线上变更称为紧急变更。

##### 2）运营类变更定义

涉及客户云平台账号及资源的管理类的变更。

##### 3）非标变更定义非标变更

是指在工程项目实施过程中，因为各种原因（如设计变更、材料供应问题、施工现场实际情况等）导致需要对原有设计或方案进行修改或调整，但这些修改/调整无法固化在环境中或不是产品支持的标准修改动作，所采取的一种针对性的变更方案（如修改docker内代码包）。

#### 2.4. 变更执行规范

##### 1）日常变更

驻场应在变更窗口期，严格按照变更方案执行。
变更执行期间一定要有变更复核人，复核人应以现场/远程方式认真复核。
因触犯变更红线所引发的故障，变更复核人也承担相应责任。
变更完成后，在客户现场具备条件下，变更验证应做到平台验证或业务验证。
变更应在结果确认后立即回填至Compass，时间不应超过24小时。

##### 2）运营类变更

此类变更应从商务侧明确为客户自运维资源变更，不属于阿里运维项目所覆盖的服务范围。

如客户有明确要求驻场执行：

- 涉及客户云平台账号及资源的创建类变更默认不需要变更流程，需客户书面/线上正式授权。
- 涉及客户云平台账号及资源的删除/释放类变更，必须走阿里云内部变更审批流程。
- 所有运营类变更需跟客户明确操作对象、操作窗口、操作内容，在获得客户正式授权后按照客户要求的内容，执行操作。

##### 3）非标变更

免责声明：如客户/产研要求CRE执行非标变更，CRE不承诺方案的可靠性和后续的稳定性，由非标变更所引发的故障和配置被回改，CRE不承担相应责任。

非标变更方案需要经过方案制定方部门主管（P9）批准，并承诺后期改进方案。
如非标变更操作复杂且风险高，则需产研现场支持。
CRE应将免责说明与相关方（客户/产研/第三方）强调说明，在相关方明确同意并做出书面/线上的正式纪要，非标变更提交时需上传相关方正式纪要。
交付侧的非标方案申请一律由 SA 在 MOP系统 发起，产研团队根据软硬件非标现状进行针对性评估，明确方案风险与后续的维护兜底，并做出书面/线上的正式纪要。
CRE团队就非标方案的影响范围、可交付性、可运维性等进行评估，不符合非标方案要求的拒绝通过。
交付过程中需严格按照非标方案执行非标交付或者变更，对现场无法交付或者变更的非标方案，现场团队应立刻停止并拉通非标方案流程审批过程中的实际制定者参与非标执行。

#### 2.5. 变更审批规范

##### 1）日常变更审批规则

一般变更：建议加签方案提供人（原厂）。
**高危变更**：必须加签变更方案提供人（原厂），CRE必须严格审核。
**紧急变更**：按风险急参考一般变更、高危变更、运营变更审批逻辑再向上加签一层
**紧急变更**（补录）：如无特殊情况，变更审批至提交人主管即可；若为故障恢复方案，必须加签对应的方案提供人（原厂），补提时间不得超过48小时。

##### 2）运营类变更审批规则

如无特殊情况，变更审批至提交人主管即可。

#### 2.6. 风险等级

- 高风险等级变更：指可能影响核心应用的变更或影响范围为多个云产品或全局性的变更。
- 中风险等级变更：指可能对非核心应用产生影响或影响范围为小范围的变更。
- 低风险等级变更：不对业务产生非预期的影响。

#### 2.7. 变更结果定义

- 成功：根据变更方案步骤实施变更，没有引起异常事件且达到变更预期；同时协助客户完成业务验证，明确变更对客户业务未产生影响即视为变更成功。
- 失败：没有完成变更，或部分完成变更，或变更引起事件，或者未达到预期。根据变更失败场景，需要有责任团队进行问题跟踪和闭环，需深入分析原因，落实改进。
- 取消：变更实施前因外部需求变化或其他不可抗因素，可以取消实施。取消变更需注明原因。
### 变更管理流程

![[Pasted image 20240911152548.png]]

#### 3.1. 变更方案输出

变更方案需至少具备以下内容:

- 适用范围：使用的版本、产品、其它说明等。
- 风险说明：该变更方案对现有业务会产生何种影响、是否有额外风险。
- 问题描述：该变更方案主要解决什么问题、满足什么需求。
- 解决方案：该变更方案的具体步骤，清晰描述每一步的准备工作、输入信息、执行过程、预期输出信息、异常处理。
- 回滚方案：该变更方案执行过程中，遇到什么情况需触发回滚方案，回滚方案的具体步骤，清晰描述每一步的准备工作、输入信息、执行过程、预期输出信息、异常处理。
- 其它补充说明。

#### 3.2. 变更申请、审批与执行

##### 1）变更申请

变更需求主要来自三个方面：

- CRE及现场服务人员在日常的运维过程中发现的问题；
- 客户根据业务情况提出的新功能或新问题需求；
- 产品研发提供的基于产品、平台的新补丁和新升级包。

交付/CRE根据收集和反馈的变更需求在变更系统记录并提交变更申请，变更申请需要包含如下定义中的所有要素：

1. 变更对象
	明确变更产品的分类，例如ECS/RDS/Galaxy等。
2. 变更窗口
	变更次数、频率取决于交付/CE与客户的沟通和协商，整体依据最小原则，尽量优化变更的次数与频率。具体变更操作窗口需要阿里云与客户双方的书面确认（钉钉、邮件或纸质文件）。变更时间原则上应该以对客户生产影响小为选择标准，同时需要在技术方案确定后跟客户沟通协商，一旦明确后不得随意更改。对于上线初期需要频繁变更的场景，变更评审委员会提前三天评审和批复重大变更申请与方案。
3. 变更计划性
	有计划的变更，都应该至少提前三个工作日提交变更申请。由客户紧急要求发起的变更也应尽早提交变更申请，并在变更原因中明确说明客户需求。修复生产环节中已有问题（故障）的变更属于紧急变更，按紧急故障修复变更处理。该情况下可以不田提前提交变更电请，但在李更发布后应尽是补提紧急变更电请并在变更原因中明确说明故障发生的紧急情况。
4. 风险等级
	按照本规范风险等级章节中的定义，按潜在用户业务影响与针对变更操作人的技术难度评估变更风险。
5. 变更方案
	具体的变更方案包含变更操作人，操作步骤，风险说明，关联影响等，请各团队视具体场景具体填写。
6. 灰度策略
	按 测试环境 - 预发环境 - 正式环境 执行灰度策略，正式环境分批次，由小到大，由不重要业务设备到重要设备，都要观察验证正确后继续，批次要考虑机器容量和冗余能力：1台观察 -> 5台观察 -> 10台观察 -> 15台 ……
7. 验证方法
	验证方法要能够切实验证变更成功与否以及是否有附带产生的其他问题。将有价值的信息同步到变更申请中，有利于风险评估及问题自查
8. 应急预案或回滚方案
	事先为变更失败制定应急预案，如回滚方案或降级措施等。如果无法回滚，也要设计补救措施并评估可能的损失，并在变更单中明确表述。
9. 变更影响面
	- 对于中高风险的变更一定要针对变更可能对用户业务的影响、对其他变更产品外其他产品的影响都有详细的说明；
	- 对用户业务的影响程度要做到定量描述，如“可造成2次3-5秒ECS虚拟机IO hang；RDS数据库可能发生不超过半分钟的连接中断”
10. 变更版本
	所有在变更中使用的版本，必是经过版本经理验证的正式版本。

##### 2）变更审批

**由CRE发起的变更**：驻场工程师提交变更，由现场复核人和TSG三方审核，判断变更类型和风险等级是否合理，不合理需要打回重提。三方审核通过后由技术服务经理再次审核，确认是否为重大（复杂）变更，是则加签技术审核员、区域TL、区域复核TL、专有云TL、L2专线、开发线；否则，系统会判断是否超过本周变更额度，超过会默认加签区域TL。最后由其他加签组里的加签人审核，完成变更审核流程。

![[Pasted image 20240911154054.png]]

**交付团队发起的变更**：

a）变更方案评审

变更经理在审批变更单时对变更方案做技术评估与确定需要升级、加签的人员。对于需要升级审核的变更：

- 变更经理将L2设置为变更单的加签人，由L2作为变更方案的技术评审人。
- L2团队不能完成评审的，由L2负责确定参与技术评审的L3具体人员，并将其设置为变更单的加签人，由L3作为变更方案的技术评审人。
- 变更经理在与L3团队已经沟通好的情况下，可以直接将L3具体人员设置为变更单的加签人，由L3作为变更方案的技术评审人，同时将L2加为变更的关注人。

对于紧急故障修复类变更，还需要将变更经理所在团队阿里云总裁DD级别的TL设置为加签人，从流程上对此类变更进行审核。

b）变更方案确认

L2/L3的技术评审人需要与变更操作人、变更申请人、变更经理切实沟通，一起评估与改进变更技术方案，之后审核通过变更方案。

c）变更方案沟通

变更方案在变更经理、加签人都审核通过后，变更操作人员应该与客户同步变更方案、申请变更窗口。

- 对于一般低风险的变更，可以根据具体项目与客户的情况，灵活使用不同的工具来记录客户授权的情况(如使用客户的变更授权系统等)。》对于中高风险等级的变更应如实向客户沟通变更存在的潜在风险与应急预案，并在取得客户的操作授权后方可进行变更发布。同时应在变更单中记录沟通的过程结果、或者客户的授权。
- 对于中高风险等级的变更，在客户确认变更窗口后，变更操作人应该主动联系变更涉及到的远程支持人员团队，明确在变更时间段的值班人员，并通过邮件/钉钉等方式告知值班人员与值班人员IL变更的具体时间安排、变更计划，并得到值班人员的确认消息。

d）变更方案发布

变更操作人需要在变更单中更新确认后的变更窗口及可能需要的远程支持人员名单，再次取得变更经理的授权（授权方式可灵活掌握），之后再按变更计划时间进行发布。远程支持人员在计划的变更时间应保证随时上线进行远程技术保障，解决潜在的问题。对于中高危险变更方案发布必须有变更经理与变更操作人双人复查、双人执行。

##### 3）变更执行

1、变更方案发布

变更操作人需要在变更单中更新确认后的变更窗口及可能需要的远程支持人员名单，再次取得变更经理的授权（授权方式可灵活掌握），之后再按变更计划时间进行发布。远程支持人员在计划的变更时间应保证随时上线进行远程技术保障，解决潜在的问题。对于中高危险变更方案发布必须有变更经理与变更操作人双人复查、双人执行。

2、变更闭环验收

变更发布完成后，变更操作人应按照变更计划进行具体的验收与业务验证，并将相应的结果（如产品的版本号、变更后新的输出等）记录在变更单中。之后关闭变更单。

## 专有云变更红线

### 变更定义

对线上系统的任何提作（发布、增加、修改或移除等），或其他对生产业务可能有影响的任何操作，变更工具产品设计及变更实施，需要满足风险防控三原则：**可灰覆**、**可监控**、**可回滚**。

- **可灰度**：变更实施应遵从灰度发布，所有变更第一批要从最小颗粒度灰度开始，灰度过程中对整个系统的状态进行监控。每批次灰度变更完成，要有手段确保验证该批次变更成功后，再进行下一批次变更；每批次的变更要避免并行变更和时间间隔过小（具体值视业务情况而定）。
- **可监控**：执行变更过程中应该监控关键系统及业务指标（整体业务功能/接口访问成功量/率、机房级流量情况rt/cpu/内存/错误日志等关键系统状态指标、上下游强依赖的业务大盘等），确认无故障后再开始下一项变更。
- **可回滚**：一旦发现变更结果不符合预期，应以优先恢复业务为原则，立即实施回滚、降级等措施。

### 变更分级

满足变更定义，按风险程度进行划分:

- **高危变更**：可能遭成集团E3及以上风险事件，或影响核心可用率指标的故障风险的变更。例如会通成密损的L4级应用，集团核心应用、跌零因子相关的变更。
- **重大变更**：可能造成P1P2故障，或影响集困级核心应用服务可用性受损的变更。例如集团及BU核心应用的变更。
- **一般变更**：未在上述范围内的其他变更。

特别说明：变更红线中的一般交更、重大变重、高危变更等判定，以结果为导向。例如：若变更导致了E3及以上故障，变更会被认为是高危变更。

### 责任说明

部分变更由客户发起，方案fo1low客户要求，无法满足可灰度/可监控/可回滚，不视为触发变更红线。
如有变更触发故障，涉及是否踩变更红线的争议，参照《专有云故障定责参考原则》，依次判断产品技术能力（是否具备可灰度/可监控/可回滚能力）、变更方案（是否具备可灰度/可监控/可回滚策略）、变更执行（是否按照可灰度/可监控/可回滚策略执行）哪个环节触发红线来区分责任。

专有云的变更主要涉及4大角色，变更红线的问责机制面向以下角色（除客户），并非仅面向变更执行人。
云产品：变更中涉及本产品的技术方案 owner 能力中心/L2：变更通用方案。
owner CRE:变更执行人。

### 填写说明

- 是否符合三板斧，首先取决于产品能力，再次取决于出方案的人；其次取决于审核风险识别；对于一线执行来说，除非未按照方案执行（方案具备三板斧原则但一线未照方案执行）才有风险；但是否具备三板斧能力，一线是最有体感的。
- 涉及数据相关的（下线/缩容/删日志/数据迁移），必须做到可灰度，可监控，可回滚，否则一线可拒绝执行，如发现存在不符合，马上拉人讨论，最高优先级。
- 涉及整个平台相关，需能够可灰度和可回滚，比如网络变更和并网（可监控目前技术上做不到）。
- 可灰度、可监控、可回滚以一线同学反馈为主，但如果产品评估为“是”，一线同学不认可提出一个反例即可。
- 变更类型取自tmo、CRE变更平台，可合并聚合；如超出以上变更类型范围，可新增行补充。
- 可灰度、可监控、可回滚列举出1个反例即判定为“部分”，并简述反例；否则判定为“是”。
